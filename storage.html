<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">

    <link rel="icon" type="image/png" sizes="32x32" href="imgs/png/main-logo.jpg">
    <link rel="icon" type="image/png" sizes="64x64" href="imgs/png/main-logo.jpg">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="css/styles-storage.css">
    <link rel="stylesheet" type="text/css" href="css/icons-fontawesome.css">

    <title>مدیریت انبار</title>
</head>

<body>

<div id="screen-black" class="d-none" onclick="closeAllSides();">
    <span id="open-modal-btn" class="d-none" data-toggle="modal" data-target="#edit-modal"></span>
</div>

<div id="leftSide">
    <h4 class="text-center mb-4 title">
        کسر از انبار
    </h4>
    <form class="mt-3 p-2">
        <div class="form-group">
            <label class="d-block text-right mb-1">
                نام محصول
            </label>
            <input type="text" name="less__name" class="form-control"/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                آلیاژ
            </label>
            <input type="text" name="less__aliage" class="form-control" placeholder="AC-not"/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                کارخانه
            </label>
            <input type="text" class="form-control" name="less__factory" placeholder="AC-not"/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                تعداد
            </label>
            <input type="number" class="form-control" name="less__count" min="1" value=""/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                تناژ
                <small class="units">kg</small>
            </label>
            <input type="number" class="form-control" name="less__tonage" min="1" value=""/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                طول
                <small class="units">m</small>
            </label>
            <input type="number" class="form-control" name="less__length" min="1" value="" step="0.01"/>
        </div>
        <div class="form-group">
            <label class="d-block text-right mb-1">
                قطر
                <small class="units">cm</small>
            </label>
            <input type="number" class="form-control" name="less__diameter" step="0.01" min="0"/>
        </div>
        <div class="form-group clearfix">
            <button class="btn btn-danger float-right" name="less__btn">
                کسر شود
            </button>
            <a href="#closeL" class="btn btn-outline-secondary float-right mr-3" onclick="closeLeftSide();">
                انصراف
            </a>
        </div>
        <section class="result-box">
            <div class="alert alert-success">
                    <span class="d-block text-right">
                        اطلاعات به درستی ثبت شدند
                        <i class="fas fa-check ml-2"></i>
                    </span>
            </div>
            <div class="alert alert-danger">
                    <span class="d-block text-right">
                        خطا در کسر
                        <i class="fa fa-exclamation-triangle ml-2"></i>
                    </span>
            </div>
        </section>
    </form>
</div>

<div id="rightSide">
    <section>
        <h4 class="text-center mb-4 title">
            افزودن به انبار
        </h4>
        <form class="mt-3 p-2">
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    نام محصول
                </label>
                <input type="text" name="add__name" class="form-control"/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    آلیاژ
                </label>
                <input type="text" name="add__aliage" class="form-control" placeholder="AC-not"/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    کارخانه
                </label>
                <input type="text" name="add__factory" class="form-control" placeholder="AC-not"/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    تعداد
                </label>
                <input type="number" name="add__count" class="form-control" min="1" value=""/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    تناژ
                    <small class="units">kg</small>
                </label>
                <input type="number" name="add__tonage" class="form-control" min="1" value=""/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    طول
                    <small class="units">m</small>
                </label>
                <input type="number" name="add__length" class="form-control" min="1" value="" step="0.01"/>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    قطر
                    <small class="units">cm</small>
                </label>
                <input type="number" name="add__diameter" class="form-control" step="0.01" min="0"/>
            </div>
            <div class="form-group clearfix">
                <button class="btn btn-success float-right" name="add__btn">
                    افزوده شود
                </button>
                <a href="#closeL" class="btn btn-outline-secondary float-right mr-3" onclick="closeRightSide();">
                    انصراف
                </a>
            </div>
            <section class="result-box">
                <div class="alert alert-success">
                        <span class="d-block text-right">
                            اطلاعات به درستی ثبت شدند
                            <i class="fas fa-check ml-2"></i>
                        </span>
                </div>
                <div class="alert alert-danger">
                        <span class="d-block text-right">
                            خطا در افزودن
                            <i class="fa fa-exclamation-triangle ml-2"></i>
                        </span>
                </div>
            </section>
        </form>
    </section>
</div>

<div id="bottomSide">
    <div class="inside">
        <section class="container-fluid">
            <div class="row pb-3">

                <!--    // TODO : just persian inputs, Eng not allowed -->
                <section id="search-box" class="col-12 mt-3 dir-r">
                    <section class="row">
                        <div class="col-lg-6 form-group">
                            <label class="d-block text-right mb-1">
                                نام محصول
                            </label>
                            <input type="text" name="search__name" class="form-control" id="search__name">
                        </div>
                        <div class="col-lg-6 form-group">
                            <label class="d-block text-right mb-1">
                                آلیاژ
                            </label>
                            <input type="text" name="search__aliage" class="form-control" id="search__aliage">
                        </div>
                        <div class="col-lg-6 form-group">
                            <label class="d-block text-right mb-1">
                                تناژ
                                <small class="units">KG</small>
                            </label>
                            <!--                           // TODO : tonage step 100??! -->
                            <input type="number" name="search__tonage" class="form-control" id="search__tonage"
                                   step="100">
                        </div>
                        <div class="col-lg-6 form-group">
                            <label class="d-block text-right mb-1">
                                طول
                                <small class="units">M</small>
                            </label>
                            <input type="number" name="search__length" class="form-control" id="search__length"
                                   step="0.01">
                        </div>
                        <div class="col-lg-6 form-group">
                            <label class="d-block text-right mb-1">
                                قطر
                                <small class="units">CM</small>
                            </label>
                            <input type="number" name="search__diameter" min="0" class="form-control"
                                   id="search__diameter" step="0.01">
                        </div>
                        <div class="col-12 form-group text-right pt-1">
                            <button class="btn btn-warning" id="search__btn" name="search__btn">
                                جستجو
                                <i class="fas fa-search mr-2"></i>
                            </button>
                        </div>
                    </section>
                </section>
            </div>
        </section>
    </div>
</div>


<div class="p-2" id="box-main">

    <!--  table title - description  -->
    <div>
        <h3 class="text-right">
            لیست همه ی محصولات اینجاست
        </h3>
        <small class="d-block text-right">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet aspernatur autem consequatur
        </small>
    </div>

    <!--    table-->
    <div class="mt-4">
        <div class="alert alert-warning mb-2 clearfix d-none" id="searchMode-box">
            <span>
                <i class="fas fa-times-circle pl-1"></i>
                خروج از حالت جستجو
            </span>
            <p class="float-right d-block w-100 text-right mb-0 mt-1 mr-2">
                تعداد نتایج :‌
                <b class="mr-2">5</b>
            </p>
        </div>
        <table class="table table-responsive-xl dir-r mb-2" id="table-main">
            <!--            icon png -->
            <tr>
                <th>
                </th>
                <th>
                    <img src="imgs/svg2/name-tag.svg" alt="">
                </th>
                <th>
                    <img src="imgs/svg2/compass.svg" alt="">
                </th>
                <th>
                    <img src="imgs/svg2/factory-2.svg" alt="">
                </th>
                <th>
                    <img src="imgs/svg2/double-arrow-1.svg" alt="">
                </th>
                <th>
                    <img src="imgs/svg2/shipping-and-delivery.svg" alt="laskd;">
                </th>
                <th>
                    <img src="imgs/svg2/count.svg" alt="">
                </th>
                <th>
                    <img src="imgs/svg2/link.svg" alt="storehouse icon">
                </th>
                <th>
                    <img src="imgs/svg2/warehouse.svg" alt="storehouse icon">
                </th>
                <th>
                    نقد
                </th>
                <th>
                    عرف
                </th>
                <th>
                    مشتری 1
                </th>
                <th>
                    مشتری 2
                </th>
                <th>
                    برش خورده
                </th>
                <th>
                    ویرایش
                </th>
            </tr>
            <!--<tr>
            <th>

            </th>
            <th>
                نام
            </th>
            <th>
                قطر
            </th>
            <th>
                کارخانه
            </th>
            <th>
                طول
            </th>
            <th>
                تناژ
            </th>
            <th>
                تعداد
            </th>
            <th>
                آلیاژ
            </th>
            <th>
                انبار
            </th>
            <th>
                نقد
            </th>
            <th>
                عرف
            </th>
            <th>
                مشتری 1
            </th>
            <th>
                مشتری 2
            </th>
            <th>
                برش خورده
            </th>
            <th>
                ویرایش
            </th>
        </tr>-->
            <tr data-rowIndex="1">
                <td>1</td>
                <td>تیرآهن</td>
                <td>20</td>
                <td>صنایع یزد</td>
                <td>25.65</td>
                <td>4500</td>
                <td>72</td>
                <td>مس - فولاد</td>
                <td>امینی</td>
                <td>5,300</td>
                <td>5,800</td>
                <td>6,200</td>
                <td>6,900</td>
                <td>7,500</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="2">
                <td>2</td>
                <td>تیرآهن</td>
                <td>25</td>
                <td>صنایع یزد</td>
                <td>25.4</td>
                <td>4100</td>
                <td>65</td>
                <td>مس - فولاد</td>
                <td>احمدی</td>
                <td>4,300</td>
                <td>5,800</td>
                <td>6,200</td>
                <td>6,900</td>
                <td>7,100</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr>
                <td colspan="15" class="report">
                    <span class="triangle"></span>
                    <b class="report-info">
                        15 تن , 16 شاخه
                    </b>
                </td>
            </tr>
            <tr data-rowIndex="3">
                <td>3</td>
                <td>ورق</td>
                <td>15</td>
                <td>صنایع یزد</td>
                <td>28.4</td>
                <td>4900</td>
                <td>45</td>
                <td>چدن</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>5,200</td>
                <td>8,200</td>
                <td>6,900</td>
                <td>9,300</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="4">
                <td>4</td>
                <td>ورق</td>
                <td>17</td>
                <td>صنایع کرمان</td>
                <td>18.4</td>
                <td>4900</td>
                <td>45</td>
                <td>آهن</td>
                <td>احمدی</td>
                <td>5,300</td>
                <td>5,200</td>
                <td>9,200</td>
                <td>6,900</td>
                <td>7,300</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="5">
                <td>5</td>
                <td>ورق</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>چدن</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr>
                <td colspan="15" class="report">
                    <span class="triangle"></span>
                    <b class="report-info">
                        8 تن , 9 ورق
                    </b>
                </td>
            </tr>
            <tr data-rowIndex="6">
                <td>6</td>
                <td>گرد</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>چدن</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr>
                <td colspan="15" class="report">
                    <span class="triangle"></span>
                    <b class="report-info">
                        8 تن , 9 گرد
                    </b>
                </td>
            </tr>
            <tr data-rowIndex="7">
                <td>7</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>چدن</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="8">
                <td>8</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="9">
                <td>9</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="10">
                <td>10</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="11">
                <td>11</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="12">
                <td>12</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr data-rowIndex="13">
                <td>13</td>
                <td>بوش</td>
                <td>55</td>
                <td>صنایع یزد</td>
                <td>29.4</td>
                <td>4300</td>
                <td>40</td>
                <td>فولاد</td>
                <td>احمدی</td>
                <td>1,300</td>
                <td>6,200</td>
                <td>8,200</td>
                <td>6,500</td>
                <td>10,800</td>
                <td>
                    <img src="imgs/svg2/edit-4.svg" alt="ویرایش"/>
                </td>
            </tr>
            <tr>
                <td colspan="15" class="report">
                    <span class="triangle"></span>
                    <b class="report-info">
                        8 تن , 9 بوش
                    </b>
                </td>
            </tr>
        </table>
    </div>
</div>


<!--
controllers
-->
<div id="open-right-side">
    <button class="btn btn-success" onclick="openRightSide()">
        <i class="fas fa-angle-double-left"></i>
    </button>
</div>
<div id="open-left-side">
    <button class="btn btn-danger" onclick="openLeftSide()">
        <i class="fas fa-angle-double-right"></i>
    </button>
</div>
<div id="open-bottom-side" class="container-fluid text-center">
    <button class="btn btn-warning" onclick="openBottomSide()">
        <i class="fas fa-angle-double-up"></i>
    </button>
</div>


<!--
edit modal
-->
<div class="modal fade" id="edit-modal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog"
     aria-labelledby="staticBackdropLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <section class="modal-header">
                <h6 class="w-100 mb-0">
                    ویرایش اطلاعات جدول
                    <i class="fas fa-times float-left" id="modal-close" data-dismiss="modal"></i>
                </h6>
            </section>
            <section>
                <form id="modal-form-edit" action="#edit" method="POST">
                    <section id="form-wrapper">

                    </section>
                    <div class="text-right">
                        <a href="#close-modal" class="btn btn-light border mr-2" data-dismiss="modal">
                            انصراف
                        </a>
                        <button class="btn btn-info">
                            اعمال تغییرات
                        </button>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>


<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script>

    function removeDouplicatedItems(list) {
        let result = [];
        $.each(list, function (i, e) {
            if ($.inArray(e, result) == -1) result.push(e);
        });
        return result;
    }

    var table_rows_count = $("#table-main tr:not(:first-child)").length;

    var list_factorys = [];
    var list_aliages = [];
    var list_names = [];


    var table_full = [];
    const titles = [
        "row_num",
        "name",
        "diam", // ghotr
        "factory",
        "leng", // length
        "tonage",
        "count",
        "aliage",
        "location",
        "cash_naghd", // naghd
        "cash_orf", // orf
        "cash_m1", // moshtari 1
        "cash_m2", // moshtari 2
        "cash_cut", // cuted
        "edit_cell"
    ];

    function tableBackUp() {
        for (let i = 2; i <= table_rows_count; i++) {
            let tr = $('#table-main tbody tr:nth-child(' + i + ')');
            if (tr.find("td").length > 4) { // check if not report td
                let row_data = [];
                tr.find("td").each(function () {
                    let td_inside = $(this).html().trim();
                    row_data.push(td_inside);
                });
                let row_obj = {};
                titles.forEach((key, value) => row_obj[key] = row_data[value]);
                table_full.push(row_obj);
            }
        }
    }

    function saveFactorys() {
        for (let i = 1; i < table_rows_count; i++) {
            let txtFactory = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(4)").html();
            if (txtFactory === undefined) {
                list_factorys = removeDouplicatedItems(list_factorys);
                return;
            }
            list_factorys.push(txtFactory);
        }
        list_factorys = removeDouplicatedItems(list_factorys);
    }

    function saveAliages() {
        for (let i = 1; i < table_rows_count; i++) {
            let txtAliage = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(8)").html();
            if (txtAliage === undefined) {
                list_aliages = removeDouplicatedItems(list_aliages);
                return;
            }
            list_aliages.push(txtAliage);
        }
        list_aliages = removeDouplicatedItems(list_aliages);
    }

    function saveNames() {
        for (let i = 1; i < table_rows_count; i++) {
            let txtName = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(2)").html();
            if (txtName === undefined) {
                list_names = removeDouplicatedItems(list_names);
                return;
            }
            list_names.push(txtName);
        }
        list_names = removeDouplicatedItems(list_names);
    }

    // when page loaded successfully, get table backup to `table_ful`
    $(document).ready(function () {
        tableBackUp();
        saveAliages();
        saveFactorys();
        saveNames();

        // auto complete input js

    });


    function getAllNames() {
        let tmpNames = [];
        let counts = table_full.length;
        for (let i = 0; i < counts; i++) {
            let name = table_full[i].name;
            let num = table_full[i].row_num;
            let obj = {};
            obj[num] = name;
            tmpNames.push(obj);
        }
        return tmpNames;
    }

    function getAllDiameters() {
        let tmpDiameters = [];
        let counts = table_full.length;
        for (let i = 0; i < counts; i++) {
            let diameter = table_full[i].diam;
            let num = table_full[i].row_num;
            let obj = {};
            obj[num] = diameter;
            tmpDiameters.push(obj);
        }
        return tmpDiameters;
    }

    function getAllLengths() {
        let tmpLengths = [];
        let counts = table_full.length;
        for (let i = 0; i < counts; i++) {
            let length = table_full[i].leng;
            let num = table_full[i].row_num;
            let obj = {};
            obj[num] = length;
            tmpLengths.push(obj);
        }
        return tmpLengths;
    }

    function getAllAliages() {
        let tmpAliages = [];
        let counts = table_full.length;
        for (let i = 0; i < counts; i++) {
            let aliage = table_full[i].aliage;
            let num = table_full[i].row_num;
            let obj = {};
            obj[num] = aliage;
            tmpAliages.push(obj);
        }
        return tmpAliages;
    }

    function getAllTonages() {
        let tmpTonage = [];
        let counts = table_full.length;
        for (let i = 0; i < counts; i++) {
            let tonage = table_full[i].tonage;
            let num = table_full[i].row_num;
            let obj = {};
            obj[num] = tonage;
            tmpTonage.push(obj);
        }
        return tmpTonage;
    }

    function startSearching(search_params) {
        // params : name, diam, len, aliage, tonage
        let productNames = getAllNames();
        let productDiameters = getAllDiameters();
        let productLength = getAllLengths();
        let productAliages = getAllAliages();
        let productTonages = getAllTonages();

        /// get top data from table , table_com... must get from backup, not table tag
        let allRowNums = [];

        // returns array e.g. [5,2,3]
        if (search_params[0].length !== 0) {
            let result_names = productNames.filter(pr => Object.values(pr)[0].includes(search_params[0])).map(pr => Number(Object.keys(pr)[0]));
            if (result_names.length > 0) {
                allRowNums.push(result_names);
            }
        }

        if (search_params[1].length !== 0) {
            let result_dimiters = productDiameters.filter(pr => Object.values(pr)[0].includes(search_params[1])).map(pr => Number(Object.keys(pr)[0]));
            if (result_dimiters.length > 0) {
                allRowNums.push(result_dimiters);
            }
        }

        if (search_params[2].length !== 0) {
            let result_lenght = productLength.filter(pr => Object.values(pr)[0].includes(search_params[2])).map(pr => Number(Object.keys(pr)[0]));
            if (result_lenght.length > 0) {
                allRowNums.push(result_lenght);
            }
        }

        if (search_params[3].length !== 0) {
            let result_aliage = productAliages.filter(pr => Object.values(pr)[0].includes(search_params[3])).map(pr => Number(Object.keys(pr)[0]));
            if (result_aliage.length > 0) {
                allRowNums.push(result_aliage);
            }
        }


        if (search_params[4].length !== 0) {
            let result_tonages = productTonages.filter(pr => Object.values(pr)[0].includes(search_params[4])).map(pr => Number(Object.keys(pr)[0]));
            if (result_tonages.length > 0) {
                allRowNums.push(result_tonages);
            }
        }

        if (allRowNums.length > 0) {
            let resultRowsNum = allRowNums.reduce(
                (join, current) => join.filter(el => current.includes(el))
            ); // array e.g. [5,3,6]
            return resultRowsNum;

        } else {
            return [];
        }
    }

    $("#search__btn").click(function () {
        let name = $("#search__name").val().trim();
        let diameter = $("#search__diameter").val().trim();
        let aliage = $("#search__aliage").val().trim();
        let tonage = $("#search__tonage").val().trim();
        let lenght = $("#search__length").val().trim();

        let search_data = [name, diameter, lenght, aliage, tonage];
        let resultRowsNum = startSearching(search_data); // returns array[1,5]

        mainTableHide();
        searchModeOn(resultRowsNum.length);

        if (resultRowsNum.length > 0) { // results found
            for (let i = 0; i < resultRowsNum.length; i++) {
                let target_tr = $("#table-main").find("tr[data-rowIndex='" + resultRowsNum[i] + "']");
                target_tr.find("td:first-child()").html("");
                target_tr.removeClass("d-none");
                target_tr.addClass("search-style-tr");
            }

        }

    });

    function mainTableHide() {
        $('#table-main tr:not(:first-child)').addClass("d-none");
    }

    function mainTableReset() {
        for (let i = 1; i <= table_rows_count; i++) {
            let tr = $("#table-main tr[data-rowIndex='" + i + "']");
            let rowIndex = tr.attr("data-rowIndex");
            if (rowIndex === undefined) {
                break;

            } else {
                tr.find("td:first-child").html(rowIndex);
                tr.removeClass("search-style-tr");
            }
        }
        $('#table-main tr:not(:first-child)').removeClass("d-none");
    }

    function reportsHide() {
        $("#table-main td.report").addClass("d-none");
    }

    function reportsShow() {
        $("#table-main td.report").removeClass("d-none");
    }


    function searchModeOn(resultsCount) {
        $('#searchMode-box b').html(resultsCount);
        $('#searchMode-box').removeClass("d-none");
        $('#searchMode-box').removeClass("animate__animated animate__zoomOut");
        $('#searchMode-box').addClass("animate__animated animate__zoomIn animate__faster");
    }

    function searchModeOff() {
        $('#searchMode-box').removeClass("animate__animated animate__zoomIn animate__faster");
        $('#searchMode-box').addClass("animate__animated animate__zoomOut");
        setTimeout(function () {
            $('#searchMode-box').delay(100).addClass("d-none");
        }, 300);
    }

    $("#searchMode-box span").click(function () {
        mainTableReset();
        searchModeOff();
    });


    // leftSide
    function openLeftSide() {
        $("#open-left-side button").fadeOut();
        $("#leftSide").attr("class", "animate__animated animate__fadeInLeft animate__faster");
        $("#leftSide").show();
        $("#screen-black").removeClass("d-none");
    }

    function closeLeftSide() {
        $("#leftSide").attr("class", "animate__animated animate__fadeOutLeft animate__fast");
        setTimeout(function () {
            $("#leftSide").hide(0);
        }, 500);
        $("#screen-black").addClass("d-none");
        $("#open-left-side button").delay(100).fadeIn();
    }

    // rightSide
    function openRightSide() {
        $("#open-right-side button").fadeOut();
        $("#rightSide").attr("class", "animate__animated animate__fadeInRight animate__faster");
        $("#rightSide").show();
        $("#screen-black").removeClass("d-none");
    }

    function closeRightSide() {
        $("#rightSide").attr("class", "animate__animated animate__fadeOutRight animate__fast");
        setTimeout(function () {
            $("#rightSide").hide(0);
        }, 500);
        $("#screen-black").addClass("d-none");
        $("#open-right-side button").delay(100).fadeIn();
    }

    function closeAllSides() {
        closeLeftSide();
        closeRightSide();
        closeBottomSide();
    }

    // bottom side
    function openBottomSide() {
        $("#bottomSide").attr("class", "animate__animated animate__fadeInUp animate__faster");
        $("#bottomSide").show();
        $("#screen-black").addClass("bg-tr");
        $("#screen-black").removeClass("d-none");
    }

    function closeBottomSide() {
        $("#bottomSide").attr("class", "animate__animated animate__fadeOutDown animate__fast");
        setTimeout(function () {
            $("#bottomSide").hide(0);
        }, 500);
        $("#screen-black").addClass("d-none");
        $("#screen-black").removeClass("bg-tr");
    }


    // input type, label, class-right-left
    var table_titrs = [
        ["type='text'", "نام", "text-right"],
        ["type='number' step='0.01'", "قطر", ""],
        ["type='text'", "کارخانه", "text-right"],
        ["type='number' step='0.01'", "طول", ""],
        ["type='number' step='0.01'", "تناژ", ""],
        ["type='number' step='0.01'", "تعداد", ""],
        ["type='text'", "آلیاژ", "text-right"],
        ["type='text'", "انبار", "text-right"],
        ["type='text'", "قیمت نقد", ""],
        ["type='text'", "قیمت عرف", ""],
        ["type='text'", "قیمت مشتری 1", ""],
        ["type='text'", "قیمت مشتری 2", ""],
        ["type='text'", "قیمت برش خورده", ""]
    ];

    function openEditModal(tag) {
        let forms = "";
        tr = tag.parents("tr");
        tr.find("td:not(:first-child):not(:last-child)").each(function (i, e) {

            let txt = $(this).text();
            forms +=
                "<div class='form-group'>" +
                "<label class='mb-0 d-block text-right'>" + table_titrs[i][1] + "</label>" +
                "<input " + table_titrs[i][0] + " class='form-control " + table_titrs[i][2] + " ' value='" + txt + "'  /> " +
                "</div>";
        });
        $("#form-wrapper").html(forms);
        forms = "";
        // open modal
        $('#open-modal-btn').trigger("click");
    }

    $("#table-main tr td:last-child img").click(function () {
        let tag = $(this);
        openEditModal(tag);
    });


    $(window).resize(function () {
        // if ($(this).width() < 650) {
        //     $("#table-main tr:nth-child(2)").attr("class", "d-none");

        // } else {
        //     $("#table-main tr:nth-child(2)").attr("class", "");
        // }
    });
</script>
</body>

</html>