<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">

    <link rel="icon" type="image/png" sizes="32x32" href="../static/imgs/png/main-logo.jpg">
    <link rel="icon" type="image/png" sizes="64x64" href="../static/imgs/png/main-logo.jpg">
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../static/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="../static/css/styles-storage.css">
    <link rel="stylesheet" type="text/css" href="../static/css/icons-fontawesome.css">
    <link rel="stylesheet" type="text/css" href="../static/css/easy-autocomplete.min.css" />

    <title>مدیریت انبار</title>
</head>

<body>

    <div id="screen-black" class="d-none" onclick="closeAllSides();">
        <span id="open-modal-btn" class="d-none" data-toggle="modal" data-target="#edit-modal"></span>
        <span id="open-modal-edit-prices-btn" class="d-none" data-toggle="modal" data-target="#edit-prices-modal"></span>
    </div>

    <div id="leftSide">
        <h4 class="text-center mb-4 title">
            کسر از انبار
        </h4>
        <form id="form-less" action="#less-save" class="mt-3 p-2">
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    نام محصول
                </label>
                <input type="text" name="less__name" class="form-control" />
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    قطر
                    <small class="units">cm</small>
                </label>
                <select class="form-control" name="less__diameter">
                    <!-- fill by js from table -->
                </select>
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    کارخانه
                </label>
                <input type="text"  class="form-control" name="less__factory" placeholder="" />
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    آلیاژ
                </label>
                <input type="text"  name="less__aliage" class="form-control" placeholder="" />
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    تعداد
                </label>
                <input type="number" class="form-control" name="less__count" min="1" value="" />
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    تناژ
                    <small class="units">kg</small>
                </label>
                <input type="number" class="form-control" name="less__tonage" min="1" value="" />
            </div>
            <div class="form-group">
                <label class="d-block text-right mb-1">
                    طول
                    <small class="units">m</small>
                </label>
                <input type="number" class="form-control" name="less__length" min="1" value="" step="0.01" />
            </div>
            <div class="form-group clearfix mb-5">
                <button class="btn btn-danger float-right" name="less__btn">
                    کسر شود
                </button>
                <a href="#close" class="btn btn-outline-secondary float-right mr-3" onclick="closeLeftSide();">
                    انصراف
                </a>
            </div>
        </form>
    </div>


    <div id="rightSide">
        <section>
            <div id="rightside-btns-box" class="pl-5 ">
                <button id="btn-product-descrip" class="btn btn-lg btn-block btn-success m-4">
                    تعریف محصول
                </button>
                <button id="btn-product-add" class="btn btn-lg btn-block btn-info m-4">
                    افزودن محصول
                </button>
            </div>
            <div id="descrip-box" class="d-none">
                <h4 class="text-center mb-4 title">
                    تعریف محصول جدید
                </h4>
                <form id="form-descrip" action="#add-save-descrip" class="mt-3 p-2">
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            نام محصول
                        </label>
                        <input type="text"  name="add__name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قطر
                            <small class="units">cm</small>
                        </label>
                        <input type="number" name="add__diameter" class="form-control" step="0.01" min="0" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            کارخانه
                        </label>
                        <input type="text"  name="add__factory" class="form-control" placeholder="" />
                    </div>
                    <div class="form-group clearfix mb-5">
                        <button class="btn btn-success float-right" name="add__btn">
                            تعریف شود
                        </button>
                        <a href="#close" class="btn btn-outline-secondary float-right mr-3" onclick="closeRightSide();">
                            انصراف
                        </a>
                    </div>
                </form>
            </div>
            <div id="increase-box" class="d-none">
                <h4 class="text-center mb-4 title">
                    افزودن محصول
                </h4>
                <form id="form-add-num" action="#add-save-count" class="mt-3 p-2">
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            نام محصول
                        </label>
                        <input type="text" name="add__name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قطر
                            <small class="units">cm</small>
                        </label>
                        <input type="number" name="add__diameter" class="form-control" step="0.01" min="0" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            کارخانه
                        </label>
                        <input type="text" name="add__factory" class="form-control" placeholder="" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            آلیاژ
                        </label>
                        <input type="text" name="add__aliage" class="form-control" placeholder="" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            تعداد
                        </label>
                        <input type="number" name="add__count" class="form-control" min="1" value="" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            تناژ
                            <small class="units">kg</small>
                        </label>
                        <input type="number" name="add__tonage" class="form-control" min="1" value="" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            طول
                            <small class="units">m</small>
                        </label>
                        <input type="number" name="add__leng" class="form-control" min="1" value="" step="0.01" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            انبار
                        </label>
                        <input type="text" name="add__location" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قیمت نقد شاخه ای
                            <small class="units">تومان</small>
                        </label>
                        <input type="number" name="add__nsh" class="form-control" min="0" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قیمت نقد برش خورده
                            <small class="units">تومان</small>
                        </label>
                        <input type="number" name="add__nbr" class="form-control" min="0" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قیمت عرف شاخه ای
                            <small class="units">تومان</small>
                        </label>
                        <input type="number" name="add__osh" class="form-control" min="0" />
                    </div>
                    <div class="form-group">
                        <label class="d-block text-right mb-1">
                            قیمت عرف برش خورده
                            <small class="units">تومان</small>
                        </label>
                        <input type="number" name="add__obr" class="form-control" min="0" />
                    </div>
                    <div class="form-group clearfix mb-5">
                        <button class="btn btn-info float-right" name="add__btn">
                            افزوده شود
                        </button>
                        <a href="#close" class="btn btn-outline-secondary float-right mr-3" onclick="closeRightSide();">
                            انصراف
                        </a>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <div id="bottomSide">
        <div class="inside">
            <section class="container-fluid">
                <div class="row pb-3">
                    <section id="search-box" class="col-12 mt-3 dir-r">
                        <section class="row">
                            <div class="col-lg-6 form-group">
                                <label class="d-block text-right mb-1">
                                    نام محصول
                                </label>
                                <input type="text" name="search__name" class="form-control" id="search__name">
                            </div>
                            <div class="col-lg-6 form-group">
                                <label class="d-block text-right mb-1">
                                    قطر
                                    <small class="units">CM</small>
                                </label>
                                <input type="number" name="search__diameter" min="0" class="form-control" id="search__diameter" step="0.01">
                            </div>
                            <div class="col-lg-6 form-group">
                                <label class="d-block text-right mb-1">
                                    کارخانه
                                </label>
                                <input type="text" name="search__factory" class="form-control" id="search__factory" >
                            </div>
                            <div class="col-12 form-group text-right pt-1">
                                <button class="btn btn-warning" id="search__btn" name="search__btn">
                                    جستجو
                                    <i class="fas fa-search mr-2"></i>
                                </button>
                            </div>
                        </section>
                    </section>
                </div>
            </section>
        </div>
    </div>


    <div class="p-2" id="box-main">

        <!--  table title - description  -->
        <div>
            <h3 class="text-right">
                لیست همه ی محصولات اینجاست
            </h3>
            <small class="d-block text-right">
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet aspernatur autem consequatur
            </small>
        </div>

        <!--    table-->
        <div class="mt-4">
            <div class="alert alert-warning mb-2 clearfix d-none" id="searchMode-box">
                <span onclick="closeSearchResults();">
                    <i class="fas fa-times-circle pl-1"></i>
                    خروج از حالت جستجو
                </span>
                <p class="float-right d-block w-100 text-right mb-0 mt-1 mr-2">
                    تعداد نتایج :‌
                    <b class="mr-2">5</b>
                </p>
            </div>
            <table class="table table-responsive-xl dir-r mb-2" id="table-main">
                <!--            icon png -->
                <tr>
                    <th>
                    </th>
                    <th>
                        کد
                    </th>
                    <th>
                        نام محصول
                    </th>
                    <th>
                        قطر
                    </th>
                    <th>
                        کارخانه
                    </th>
                    <th>
                        طول
                    </th>
                    <th>
                        تناژ
                    </th>
                    <th>
                        تعداد
                    </th>
                    <th>
                        آلیاژ
                    </th>
                    <th>
                        انبار
                    </th>
                    <th>
                        نقد شاخه ای
                    </th>
                    <th>
                        نقد برش خورده
                    </th>
                    <th>
                        عرف شاخه ای
                    </th>
                    <th>
                        عرف برش خورده
                    </th>
                    <th>
                        ویرایش
                    </th>
                </tr>
                <tr data-rowIndex="1">
                    <td>1</td>
                    <td>C880</td>
                    <td>تیرآهن</td>
                    <td>20</td>
                    <td>صنایع یزد</td>
                    <td>25.65</td>
                    <td>4500</td>
                    <td>72</td>
                    <td>مس - فولاد</td>
                    <td>امینی</td>
                    <td>5,300</td>
                    <td>5,800</td>
                    <td>6,200</td>
                    <td>6,900</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="2">
                    <td>2</td>
                    <td>C880</td>
                    <td>تیرآهن</td>
                    <td>25</td>
                    <td>صنایع یزد</td>
                    <td>25.4</td>
                    <td>4100</td>
                    <td>65</td>
                    <td>مس - فولاد</td>
                    <td>احمدی</td>
                    <td>4,300</td>
                    <td>5,800</td>
                    <td>6,200</td>
                    <td>6,900</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr>
                    <td colspan="15" class="report">
                        <span class="triangle"></span>
                        <i class="fas fa-wrench edit-prices"></i>
                        <b class="report-info">
                            15 تن , 16 شاخه
                        </b>
                    </td>
                </tr>
                <tr data-rowIndex="3">
                    <td>3</td>
                    <td>K750</td>
                    <td>ورق</td>
                    <td>15</td>
                    <td>صنایع یزد</td>
                    <td>28.4</td>
                    <td>4900</td>
                    <td>45</td>
                    <td>چدن</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>5,200</td>
                    <td>8,200</td>
                    <td>6,900</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="4">
                    <td>4</td>
                    <td>K750</td>
                    <td>ورق</td>
                    <td>17</td>
                    <td>صنایع کرمان</td>
                    <td>18.4</td>
                    <td>4900</td>
                    <td>45</td>
                    <td>آهن</td>
                    <td>احمدی</td>
                    <td>5,300</td>
                    <td>5,200</td>
                    <td>9,200</td>
                    <td>6,900</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="5">
                    <td>5</td>
                    <td>K750</td>
                    <td>ورق</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>چدن</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr>
                    <td colspan="15" class="report">
                        <span class="triangle"></span>
                        <i class="fas fa-wrench edit-prices"></i>
                        <b class="report-info">
                            8 تن , 9 ورق
                        </b>
                    </td>
                </tr>
                <tr data-rowIndex="6">
                    <td>6</td>
                    <td>T700</td>
                    <td>گرد</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>چدن</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr>
                    <td colspan="15" class="report">
                        <span class="triangle"></span>
                        <i class="fas fa-wrench edit-prices"></i>
                        <b class="report-info">
                            8 تن , 9 گرد
                        </b>
                    </td>
                </tr>
                <tr data-rowIndex="7">
                    <td>7</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>چدن</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="8">
                    <td>8</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="9">
                    <td>9</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="10">
                    <td>10</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="11">
                    <td>11</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="12">
                    <td>12</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr data-rowIndex="13">
                    <td>13</td>
                    <td>F500</td>
                    <td>بوش</td>
                    <td>55</td>
                    <td>صنایع یزد</td>
                    <td>29.4</td>
                    <td>4300</td>
                    <td>40</td>
                    <td>فولاد</td>
                    <td>احمدی</td>
                    <td>1,300</td>
                    <td>6,200</td>
                    <td>8,200</td>
                    <td>6,500</td>
                    <td>
                        <img src="../static/imgs/svg/edit-4.svg" alt="ویرایش" />
                    </td>
                </tr>
                <tr>
                    <td colspan="15" class="report">
                        <span class="triangle"></span>
                        <i class="fas fa-wrench edit-prices"></i>
                        <b class="report-info">
                            8 تن , 9 بوش
                        </b>
                    </td>
                </tr>
            </table>
        </div>
    </div>


    <!--
controllers
-->
    <div id="top-show-price">
        <button class="btn btn-dark" id="btn-show-price" data-blurstate="on">
            نمایش قیمت ها
        </button>
    </div>
    <div id="open-right-side">
        <button class="btn btn-success" onclick="openRightSide()">
            <i class="fas fa-angle-double-left"></i>
        </button>
    </div>
    <div id="open-left-side">
        <button class="btn btn-danger" onclick="openLeftSide()">
            <i class="fas fa-angle-double-right"></i>
        </button>
    </div>
    <div id="open-bottom-side" class="container-fluid text-center">
        <button class="btn btn-warning" onclick="openBottomSide()">
            <i class="fas fa-angle-double-up"></i>
        </button>
    </div>


<!--
    model general edit
-->
    <div class="modal fade" id="edit-modal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <section class="modal-header">
                    <h6 class="w-100 mb-0">
                        ویرایش اطلاعات جدول
                        <i class="fas fa-times float-left" id="modal-close" data-dismiss="modal"></i>
                    </h6>
                </section>
                <section>
                    <form id="modal-form-edit" action="/edit-save" method="POST">
                        <section id="form-wrapper">
                        </section>
                        <div class="text-right">
                            <a href="#close-modal" class="btn btn-light border mr-2" data-dismiss="modal">
                                انصراف
                            </a>
                            <button class="btn btn-info">
                                اعمال تغییرات
                            </button>
                        </div>
                    </form>
                </section>
            </div>
        </div>
    </div>

<!--
    model prices edit
-->
    <div class="modal fade" id="edit-prices-modal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <section class="modal-header">
                    <h6 class="w-100 mb-0">
                        ویرایش قیمت ها
                        <i class="fas fa-times float-left" id="edit-prices-modal-closeBtn" data-dismiss="modal"></i>
                    </h6>
                </section>
                <section>
                    <form class="form-edit-prices" action="/edit-prices-save" method="POST">
                        <div class="form-group">
                            <label class="mb-1 text-right d-block">نقد شاخه ای</label>
                            <input type="text" class="form-control " name="edit-prices-nsh" value="" />
                        </div>
                        <div class="form-group">
                            <label class="mb-1 text-right d-block">نقد برش خورده</label>
                            <input type="text" class="form-control " name="edit-prices-nbr" value="" />
                        </div>
                        <div class="form-group">
                            <label class="mb-1 text-right d-block">عرف شاخه ای</label>
                            <input type="text" class="form-control " name="edit-prices-osh" value="" />
                        </div>
                        <div class="form-group">
                            <label class="mb-1 text-right d-block">عرف برش خورده</label>
                            <input type="text" class="form-control " name="edit-prices-obr" value="" />
                        </div>
                        <div class="text-right mt-4">
                            <a href="#close-modal" class="btn btn-light border mr-2" data-dismiss="modal">
                                انصراف
                            </a>
                            <button class="btn btn-info">
                                اعمال تغییرات
                            </button>
                        </div>
                    </form>
                </section>
            </div>
        </div>
    </div>



    <script src="../static/js/jquery-3.5.1.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/jquery.easy-autocomplete.min.js"></script>


    <script>

        $('.edit-prices').click(function () {
            let tr = $(this).parents('tr');
            let indexNum = tr.index();
            let topTr = $('#table-main tr:eq('+ (indexNum - 1) +')');
            let priceNsh = topTr.find('td:eq(10)').text();
            let priceNbr = topTr.find('td:eq(11)').text();
            let priceOsh = topTr.find('td:eq(12)').text();
            let priceObr = topTr.find('td:eq(13)').text();
            $('#edit-prices-modal [name="edit-prices-nsh"]').attr("value", priceNsh);
            $('#edit-prices-modal [name="edit-prices-nbr"]').attr("value", priceNbr);
            $('#edit-prices-modal [name="edit-prices-osh"]').attr("value", priceOsh);
            $('#edit-prices-modal [name="edit-prices-obr"]').attr("value", priceObr);
            // open modal
            $('#open-modal-edit-prices-btn').trigger('click');
        });


        $('#btn-product-descrip').click(function () {
            $('#rightside-btns-box').addClass("d-none");
            $('#descrip-box').removeClass("d-none");
        });

        $('#btn-product-add').click(function () {
            $('#rightside-btns-box').addClass("d-none");
            $('#increase-box').removeClass("d-none");
        });


        function blurAllPrice() {
            $("#table-main tr").find("td:nth-child(11)").addClass("price-blur");
            $("#table-main tr").find("td:nth-child(12)").addClass("price-blur");
            $("#table-main tr").find("td:nth-child(13)").addClass("price-blur");
            $("#table-main tr").find("td:nth-child(14)").addClass("price-blur");
            $("#btn-show-price").attr("data-blurstate", "on");
        }

        function unblurAllPrice() {
            $("#table-main tr").find("td:nth-child(11)").removeClass("price-blur");
            $("#table-main tr").find("td:nth-child(12)").removeClass("price-blur");
            $("#table-main tr").find("td:nth-child(13)").removeClass("price-blur");
            $("#table-main tr").find("td:nth-child(14)").removeClass("price-blur");
            $("#btn-show-price").attr("data-blurstate", "off");
        }

        $("#btn-show-price").click(function () {
            unblurAllPrice();
            setTimeout(blurAllPrice, 90000);
        });


        function removeDouplicatedItems(list) {
            let result = [];
            $.each(list, function (i, e) {
                if ($.inArray(e, result) == -1) result.push(e);
            });
            return result;
        }

        var table_rows_count = $("#table-main tr:not(:first-child)").length;

        var list_factorys = [];
        var list_aliages = [];
        var list_names = [];
        var list_diamiters = [];
        var table_full = [];
        const titles = [
            "row_num",
            "code",
            "name",
            "diam", // ghotr
            "factory",
            "leng", // length
            "tonage",
            "count",
            "aliage",
            "location",
            "cash_nsh",
            "cash_nbr",
            "cash_osh",
            "cash_obr",
            "edit_cell"
        ];

        function tableBackUp() {
            for (let i = 2; i <= table_rows_count; i++) {
                let tr = $('#table-main tbody tr:nth-child(' + i + ')');
                if (tr.find("td").length > 4) { // check if not report td
                    let row_data = [];
                    tr.find("td").each(function () {
                        let td_inside = $(this).html().trim();
                        row_data.push(td_inside);
                    });
                    let row_obj = {};
                    titles.forEach((key, value) => row_obj[key] = row_data[value]);
                    table_full.push(row_obj);
                }
            }
        }

        function saveFactorys() {
            for (let i = 1; i < table_rows_count; i++) {
                let txtFactory = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(5)").html();
                if (txtFactory === undefined) {
                    list_factorys = removeDouplicatedItems(list_factorys);
                    return;
                }
                list_factorys.push(txtFactory);
            }
            list_factorys = removeDouplicatedItems(list_factorys);
        }


        function saveDiameters() {
            for (let i = 1; i < table_rows_count; i++) {
                let txtDiameter = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(4)").html();
                if (txtDiameter === undefined) {
                    list_diamiters = removeDouplicatedItems(list_diamiters);
                    return;
                }
                list_diamiters.push(txtDiameter);
            }
            list_diamiters = removeDouplicatedItems(list_diamiters);
        }


        function saveAliages() {
            for (let i = 1; i < table_rows_count; i++) {
                let txtAliage = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(9)").html();
                if (txtAliage === undefined) {
                    list_aliages = removeDouplicatedItems(list_aliages);
                    return;
                }
                list_aliages.push(txtAliage);
            }
            list_aliages = removeDouplicatedItems(list_aliages);
        }

        function saveNames() {
            for (let i = 1; i < table_rows_count; i++) {
                let txtName = $("#table-main").find("tr[data-rowIndex='" + i + "'] td:nth-child(3)").html();
                if (txtName === undefined) {
                    list_names = removeDouplicatedItems(list_names);
                    return;
                }
                list_names.push(txtName);
            }
            list_names = removeDouplicatedItems(list_names);
        }

        // add select option
        function setLeftSideDiameters() {
            let options = '';
            for (let i = 0; i < list_diamiters.length; i++) {
                let oneRow =
                    '<option value="' + list_diamiters[i] + '">'
                    + list_diamiters[i]
                    + '</option>';

                options += oneRow;
            }
            $('select[name="less__diameter"]').append(options);
        }




        // when page loaded successfully do first tasks
        $(document).ready(function () {
            blurAllPrice();
            tableBackUp();
            saveAliages();
            saveFactorys();
            saveNames();
            saveDiameters();

            setLeftSideDiameters();




            // auto complete input js
            // ************* names
            var autoComplete_names = {
                data: list_names
            };
            let lessName = $("[name='less__name']");
            $(lessName).easyAutocomplete(autoComplete_names);

            let addName = $("[name='add__name']");
            $(addName).easyAutocomplete(autoComplete_names);

            let searchName = $("[name='search__name']");
            $(searchName).easyAutocomplete(autoComplete_names);


            // ************* aliages
            var autocomplete_aliages = {
                data: list_aliages
            };
            let lessAliage = $("[name='less__aliage']");
            $(lessAliage).easyAutocomplete(autocomplete_aliages);

            let addAliage = $("[name='add__aliage']");
            $(addAliage).easyAutocomplete(autocomplete_aliages);


            // ************* factorys
            var autocomplete_factorys = {
                data: list_factorys
            };
            let lessFactorys = $("[name='less__factory']");
            $(lessFactorys).easyAutocomplete(autocomplete_factorys);

            let addFactorys = $("[name='add__factory']");
            $(addFactorys).easyAutocomplete(autocomplete_factorys);

            let searchFactorys = $("[name='search__factory']");
            $(searchFactorys).easyAutocomplete(autocomplete_factorys);


            // ++++++++++++++++++++
            $(document).keyup(function (e) {
                if (e.key === "Escape") {
                    closeSearchResults();
                    closeAllSides();
                }
            });

        });


        function getAllNames() {
            let tmpNames = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let name = table_full[i].name;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = name;
                tmpNames.push(obj);
            }
            return tmpNames;
        }

        function getAllDiameters() {
            let tmpDiameters = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let diameter = table_full[i].diam;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = diameter;
                tmpDiameters.push(obj);
            }
            return tmpDiameters;
        }

        function getAllLengths() {
            let tmpLengths = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let length = table_full[i].leng;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = length;
                tmpLengths.push(obj);
            }
            return tmpLengths;
        }

        function getAllAliages() {
            let tmpAliages = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let aliage = table_full[i].aliage;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = aliage;
                tmpAliages.push(obj);
            }
            return tmpAliages;
        }

        function getAllTonages() {
            let tmpTonage = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let tonage = table_full[i].tonage;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = tonage;
                tmpTonage.push(obj);
            }
            return tmpTonage;
        }

        function getAllFactory() {
            let tmpFactory = [];
            let counts = table_full.length;
            for (let i = 0; i < counts; i++) {
                let factory = table_full[i].factory;
                let num = table_full[i].row_num;
                let obj = {};
                obj[num] = factory;
                tmpFactory.push(obj);
            }
            return tmpFactory;
        }

        function startSearching(search_params) {
            // params : name, diam, len, aliage, tonage
            let productNames = getAllNames();
            let productDiameters = getAllDiameters();
            let productFactory = getAllFactory();

            /// get top data from table , table_com... must get from backup, not table tag
            let allRowNums = [];

            // returns array e.g. [5,2,3]
            if (search_params[0].length !== 0) {
                let result_names = productNames.filter(pr => Object.values(pr)[0].includes(search_params[0])).map(pr => Number(Object.keys(pr)[0]));
                if (result_names.length > 0) {
                    allRowNums.push(result_names);
                }
            }

            if (search_params[1].length !== 0) {
                let result_dimiters = productDiameters.filter(pr => Object.values(pr)[0].includes(search_params[1])).map(pr => Number(Object.keys(pr)[0]));
                if (result_dimiters.length > 0) {
                    allRowNums.push(result_dimiters);
                }
            }


            if (search_params[2].length !== 0) {
                let result_factorys = productFactory.filter(pr => Object.values(pr)[0].includes(search_params[2])).map(pr => Number(Object.keys(pr)[0]));
                if (result_factorys.length > 0) {
                    allRowNums.push(result_factorys);
                }
            }

            if (allRowNums.length > 0) {
                let resultRowsNum = allRowNums.reduce(
                    (join, current) => join.filter(el => current.includes(el))
                ); // array e.g. [5,3,6]
                return resultRowsNum;

            } else {
                return [];
            }
        }

        $("#search__btn").click(function () {
            let name = $("#search__name").val().trim();
            let diameter = $("#search__diameter").val().trim();
            let factory = $("#search__factory").val().trim();

            let search_data = [name, diameter, factory];
            let resultRowsNum = startSearching(search_data); // returns array[1,5]

            mainTableHide();
            searchModeOn(resultRowsNum.length);

            if (resultRowsNum.length > 0) { // results found
                for (let i = 0; i < resultRowsNum.length; i++) {
                    let target_tr = $("#table-main").find("tr[data-rowIndex='" + resultRowsNum[i] + "']");
                    target_tr.find("td:first-child()").html("");
                    target_tr.removeClass("d-none");
                    target_tr.addClass("search-style-tr");
                }

            }

        });

        function mainTableHide() {
            $('#table-main tr:not(:first-child)').addClass("d-none");
        }

        function mainTableReset() {
            for (let i = 1; i <= table_rows_count; i++) {
                let tr = $("#table-main tr[data-rowIndex='" + i + "']");
                let rowIndex = tr.attr("data-rowIndex");
                if (rowIndex === undefined) {
                    break;

                } else {
                    tr.find("td:first-child").html(rowIndex);
                    tr.removeClass("search-style-tr");
                }
            }
            $('#table-main tr:not(:first-child)').removeClass("d-none");
        }


        function searchModeOn(resultsCount) {
            $('#searchMode-box b').html(resultsCount);
            $('#searchMode-box').removeClass("d-none");
            $('#searchMode-box').removeClass("animate__animated animate__zoomOut");
            $('#searchMode-box').addClass("animate__animated animate__zoomIn animate__faster");
        }

        function searchModeOff() {
            $('#searchMode-box').removeClass("animate__animated animate__zoomIn animate__faster");
            $('#searchMode-box').addClass("animate__animated animate__zoomOut");
            setTimeout(function () {
                $('#searchMode-box').delay(100).addClass("d-none");
            }, 300);
        }

        // close search mode
        function closeSearchResults(){
            mainTableReset();
            searchModeOff();
        }


        // leftSide
        function openLeftSide() {
            $("#open-left-side button").fadeOut();
            $("#leftSide").attr("class", "animate__animated animate__fadeInLeft animate__faster");
            $("#leftSide").show();
            $("#screen-black").removeClass("d-none");
        }

        function closeLeftSide() {
            $('#form-less').trigger('reset');
            $("#leftSide").attr("class", "animate__animated animate__fadeOutLeft animate__fast");
            setTimeout(function () {
                $("#leftSide").hide(0);
            }, 500);
            $("#screen-black").addClass("d-none");
            $("#open-left-side button").delay(100).fadeIn();
        }

        // rightSide
        function openRightSide() {
            $("#open-right-side button").fadeOut();
            $("#rightSide").attr("class", "animate__animated animate__fadeInRight animate__faster");
            $("#rightSide").show();
            $("#screen-black").removeClass("d-none");

            $('#rightside-btns-box').removeClass("d-none");
            $('#descrip-box').addClass("d-none");
            $('#increase-box').addClass("d-none");
        }

        function closeRightSide() {
            $('#form-descrip').trigger('reset');
            $('#form-add-num').trigger('reset');
            $("#rightSide").attr("class", "animate__animated animate__fadeOutRight animate__fast");
            setTimeout(function () {
                $("#rightSide").hide(0);
            }, 500);
            $("#screen-black").addClass("d-none");
            $("#open-right-side button").delay(100).fadeIn();
        }

        function closeAllSides() {
            closeLeftSide();
            closeRightSide();
            closeBottomSide();
        }

        // bottom side
        function openBottomSide() {
            $("#bottomSide").attr("class", "animate__animated animate__fadeInUp animate__faster");
            $("#bottomSide").show();
            $("#screen-black").addClass("bg-tr");
            $("#screen-black").removeClass("d-none");
        }

        function closeBottomSide() {
            $("#bottomSide").attr("class", "animate__animated animate__fadeOutDown animate__fast");
            setTimeout(function () {
                $("#bottomSide").hide(0);
            }, 500);
            $("#screen-black").addClass("d-none");
            $("#screen-black").removeClass("bg-tr");
        }


        // input type, label, class-right-left
        var table_titrs = [
            ["type='text' name='edit__code' readonly", "کد", ""], // code
            ["type='text' name='edit__name' readonly", "نام", "text-right"], // name
            ["type='number' step='0.01' name='edit__diameter' readonly", "قطر", ""], // diam
            ["type='text' name='edit__factory' readonly", "کارخانه", "text-right"], // factory
            ["type='number' step='0.01' name='edit__leng'", "طول", ""], // leng
            ["type='number' step='0.01' name='edit__tonage'", "تناژ", ""], // tonage
            ["type='number' step='0.01' name='edit__count'", "تعداد", ""], // count
            ["type='text' name='edit__aliage' readonly", "آلیاژ", "text-right"], // aliage
            ["type='text' name='edit__location'", "انبار", "text-right"], // storage -- delete
            ["type='text' name='edit__nsh' readonly", "قیمت نقد شاخه ای", ""], // naghd shakhe
            ["type='text' name='edit__nbr' readonly", "قیمت نقد برش خورده", ""], // naghd borsh
            ["type='text' name='edit__obr' readonly", "قیمت عرف شاخه ای", ""], // orf shakhe
            ["type='text' name='edit__osh' readonly", "قیمت عرف برش خورده", ""] // orf borsh
        ];

        function openEditModal(tag) {
            let forms = "";
            tr = tag.parents("tr");

            tr.find("td:not(:first-child):not(:last-child):not(:nth-child(1))").each(function (i, e) {
                let txt = $(this).text();
                let displayNone = "";
                if (i === 8) {  // 8 index of storage
                    displayNone = "d-none";
                }
                forms +=
                    "<div class='form-group " + displayNone + "'>" +
                    "<label class='mb-0 d-block text-right'>" + table_titrs[i][1] + "</label>" +
                    "<input " + table_titrs[i][0] + " class='form-control " + table_titrs[i][2] + " ' value='" + txt + "'  /> " +
                    "</div>"
                    ;
            });

            $("#form-wrapper").html(forms);
            forms = "";
            // open modal
            $('#open-modal-btn').trigger("click");
        }

        $("#table-main tr td:last-child img").click(function () {
            let tag = $(this);
            openEditModal(tag);
        });


    </script>
</body>

</html>